<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reactivity模块基本使用 | 定投改变命运</title>
    <meta name="description" content="用注意力填满 1000 小时就能练成任何你需要的技能……">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/vitepressBlog/assets/style.BTwz5bQc.css" as="style">
    <link rel="preload stylesheet" href="/vitepressBlog/vp-icons.css" as="style">
    
    <script type="module" src="/vitepressBlog/assets/app.DqRWmf_k.js"></script>
    <link rel="preload" href="/vitepressBlog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/vitepressBlog/assets/chunks/theme.Cuoog4-E.js">
    <link rel="modulepreload" href="/vitepressBlog/assets/chunks/framework.K2WCgrB4.js">
    <link rel="modulepreload" href="/vitepressBlog/assets/vue_vue3_04.reactivity-2.md.BAqMiYot.lean.js">
    <link rel="icon" href="/images/clock.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-666bb751><!--[--><!--]--><!--[--><span tabindex="-1" data-v-28214a47></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-28214a47>Skip to content</a><!--]--><!----><header class="VPNav" data-v-666bb751 data-v-b9bbaa84><div class="VPNavBar has-sidebar top" data-v-b9bbaa84 data-v-9ef41547><div class="wrapper" data-v-9ef41547><div class="container" data-v-9ef41547><div class="title" data-v-9ef41547><div class="VPNavBarTitle has-sidebar" data-v-9ef41547 data-v-64734421><a class="title" href="/vitepressBlog/" data-v-64734421><!--[--><!--]--><!----><span data-v-64734421>定投改变命运</span><!--[--><!--]--></a></div></div><div class="content" data-v-9ef41547><div class="content-body" data-v-9ef41547><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9ef41547><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9ef41547 data-v-e254d0ee><span id="main-nav-aria-label" class="visually-hidden" data-v-e254d0ee> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepressBlog/ai/index.html" tabindex="0" data-v-e254d0ee data-v-dfbaf69f><!--[--><span data-v-dfbaf69f>AI</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepressBlog/web3/index.html" tabindex="0" data-v-e254d0ee data-v-dfbaf69f><!--[--><span data-v-dfbaf69f>web3</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9ef41547 data-v-ea6865a2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-ea6865a2 data-v-e70a6fa1 data-v-96b2e233><span class="check" data-v-96b2e233><span class="icon" data-v-96b2e233><!--[--><span class="vpi-sun sun" data-v-e70a6fa1></span><span class="vpi-moon moon" data-v-e70a6fa1></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9ef41547 data-v-f1a465d7 data-v-ede2b920><!--[--><a class="VPSocialLink no-icon" href="https://github.com/MagicalBridge" aria-label="github" target="_blank" rel="noopener" data-v-ede2b920 data-v-e0a06054><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9ef41547 data-v-5c0714cb data-v-82734cac><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-82734cac><span class="vpi-more-horizontal icon" data-v-82734cac></span></button><div class="menu" data-v-82734cac><div class="VPMenu" data-v-82734cac data-v-3e360766><!----><!--[--><!--[--><!----><div class="group" data-v-5c0714cb><div class="item appearance" data-v-5c0714cb><p class="label" data-v-5c0714cb>Appearance</p><div class="appearance-action" data-v-5c0714cb><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-5c0714cb data-v-e70a6fa1 data-v-96b2e233><span class="check" data-v-96b2e233><span class="icon" data-v-96b2e233><!--[--><span class="vpi-sun sun" data-v-e70a6fa1></span><span class="vpi-moon moon" data-v-e70a6fa1></span><!--]--></span></span></button></div></div></div><div class="group" data-v-5c0714cb><div class="item social-links" data-v-5c0714cb><div class="VPSocialLinks social-links-list" data-v-5c0714cb data-v-ede2b920><!--[--><a class="VPSocialLink no-icon" href="https://github.com/MagicalBridge" aria-label="github" target="_blank" rel="noopener" data-v-ede2b920 data-v-e0a06054><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9ef41547 data-v-19990c24><span class="container" data-v-19990c24><span class="top" data-v-19990c24></span><span class="middle" data-v-19990c24></span><span class="bottom" data-v-19990c24></span></span></button></div></div></div></div><div class="divider" data-v-9ef41547><div class="divider-line" data-v-9ef41547></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-666bb751 data-v-ac090a65><div class="container" data-v-ac090a65><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-ac090a65><span class="vpi-align-left menu-icon" data-v-ac090a65></span><span class="menu-text" data-v-ac090a65>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-ac090a65 data-v-8135474b><button data-v-8135474b>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-666bb751 data-v-b9290e23><div class="curtain" data-v-b9290e23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b9290e23><span class="visually-hidden" id="sidebar-aria-label" data-v-b9290e23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-697c26bc><section class="VPSidebarItem level-0 collapsible" data-v-697c26bc data-v-12e80c2c><div class="item" role="button" tabindex="0" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><h2 class="text" data-v-12e80c2c>Vue3框架介绍</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12e80c2c><span class="vpi-chevron-right caret-icon" data-v-12e80c2c></span></div></div><div class="items" data-v-12e80c2c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/01.introduce.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Vue3整体架构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/02.start.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Vue3开发环境搭建</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-697c26bc><section class="VPSidebarItem level-0 collapsible has-active" data-v-697c26bc data-v-12e80c2c><div class="item" role="button" tabindex="0" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><h2 class="text" data-v-12e80c2c>Vue3响应式原理</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12e80c2c><span class="vpi-chevron-right caret-icon" data-v-12e80c2c></span></div></div><div class="items" data-v-12e80c2c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/03.reactivity-1.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Vue3响应式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/04.reactivity-2.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Reactive & Effect</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/05.reactivity-3.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Computed & Watch</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/06.ref.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Ref实现原理</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-697c26bc><section class="VPSidebarItem level-0 collapsible" data-v-697c26bc data-v-12e80c2c><div class="item" role="button" tabindex="0" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><h2 class="text" data-v-12e80c2c>Vue3渲染原理</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12e80c2c><span class="vpi-chevron-right caret-icon" data-v-12e80c2c></span></div></div><div class="items" data-v-12e80c2c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/07.renderer.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Vue3自定义渲染器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/08.runtime-dom.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Runtime DOM</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/09.runtime-core.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Runtime Core</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-697c26bc><section class="VPSidebarItem level-0 collapsible" data-v-697c26bc data-v-12e80c2c><div class="item" role="button" tabindex="0" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><h2 class="text" data-v-12e80c2c>Vue3 Diff 算法</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12e80c2c><span class="vpi-chevron-right caret-icon" data-v-12e80c2c></span></div></div><div class="items" data-v-12e80c2c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/10.diff.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Diff流程</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-697c26bc><section class="VPSidebarItem level-0 collapsible" data-v-697c26bc data-v-12e80c2c><div class="item" role="button" tabindex="0" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><h2 class="text" data-v-12e80c2c>组件渲染原理</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12e80c2c><span class="vpi-chevron-right caret-icon" data-v-12e80c2c></span></div></div><div class="items" data-v-12e80c2c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/11.fragment.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>text、Fragment</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/12.component.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>组件渲染</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/13.compositionApi.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>setup函数</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-697c26bc><section class="VPSidebarItem level-0 collapsible" data-v-697c26bc data-v-12e80c2c><div class="item" role="button" tabindex="0" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><h2 class="text" data-v-12e80c2c>模板编译原理</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12e80c2c><span class="vpi-chevron-right caret-icon" data-v-12e80c2c></span></div></div><div class="items" data-v-12e80c2c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/14.optimize.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>编译优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/15.ast.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>模板转化为AST</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/16.transform.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>代码转化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue3/17.codegen.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>代码生成</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-697c26bc><section class="VPSidebarItem level-0 collapsible" data-v-697c26bc data-v-12e80c2c><div class="item" role="button" tabindex="0" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><h2 class="text" data-v-12e80c2c>Vue2核心原理</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12e80c2c><span class="vpi-chevron-right caret-icon" data-v-12e80c2c></span></div></div><div class="items" data-v-12e80c2c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue2/01.source.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>Vue2初渲染原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-12e80c2c data-v-12e80c2c><div class="item" data-v-12e80c2c><div class="indicator" data-v-12e80c2c></div><a class="VPLink link link" href="/vitepressBlog/vue/vue2/02.%E6%B8%B2%E6%9F%93watcher.html" data-v-12e80c2c><!--[--><p class="text" data-v-12e80c2c>创建渲染Watcher</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-666bb751 data-v-f30382c3><div class="VPDoc has-sidebar has-aside" data-v-f30382c3 data-v-0786f3f5><!--[--><!--]--><div class="container" data-v-0786f3f5><div class="aside" data-v-0786f3f5><div class="aside-curtain" data-v-0786f3f5></div><div class="aside-container" data-v-0786f3f5><div class="aside-content" data-v-0786f3f5><div class="VPDocAside" data-v-0786f3f5 data-v-a6ce255e><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-a6ce255e data-v-e9922aff><div class="content" data-v-e9922aff><div class="outline-marker" data-v-e9922aff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-e9922aff>On this page</div><ul class="VPDocOutlineItem root" data-v-e9922aff data-v-6eeb71bd><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-a6ce255e></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-0786f3f5><div class="content-container" data-v-0786f3f5><!--[--><!--]--><main class="main" data-v-0786f3f5><div style="position:relative;" class="vp-doc _vitepressBlog_vue_vue3_04_reactivity-2" data-v-0786f3f5><div><h1 id="reactivity模块基本使用" tabindex="-1">Reactivity模块基本使用 <a class="header-anchor" href="#reactivity模块基本使用" aria-label="Permalink to &quot;Reactivity模块基本使用&quot;">​</a></h1><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./reactivity.global.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    shallowReactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    shallowReadonly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    readonly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VueReactivity;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // let state = reactive({ name: &#39;jw&#39;, age: 30 });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // const state = shallowReactive({ name: &#39;jw&#39;, age: 30 })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // const state = readonly({ name: &#39;jw&#39;, age: 30 })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jw&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 副作用函数 (effect执行渲染了页面)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    app.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;今年&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;岁了&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state.age</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><blockquote><p><code>reactive</code> 方法会将对象变成<code>proxy对象</code>， <code>effect</code>中使用<code>reactive</code>对象时会进行依赖收集，稍后属性变化时会重新执行<code>effect</code>函数。</p></blockquote><p>effect这个函数是vue3中的响应式的核心，computed和watch都是基于它来实现的。这里所说的依赖收集指的是数据会记录自己在哪个effect中被使用了，当数据变化的时候，会通知effect函数重新执行，从而达到数据更新，页面更新的目的。</p><h2 id="reactive-函数实现" tabindex="-1">reactive 函数实现 <a class="header-anchor" href="#reactive-函数实现" aria-label="Permalink to &quot;reactive 函数实现&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { isObject } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@vue/shared&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createReactiveObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isReadonly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 常用的就是reactive方法</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createReactiveObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 后面的方法，不是重点,我们先不进行实现... </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">export function shallowReactive(target: object) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  return createReactiveObject(target, false)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">export function readonly(target: object) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  return createReactiveObject(target, true)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">export function shallowReadonly(target: object) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  return createReactiveObject(target, true)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;object&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>从上面的代码逻辑来看，<code>reactive</code>这个函数只会处理对象类型的数据，不是对象类型的数据直接返回。</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reactiveMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WeakMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 缓存列表</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mutableHandlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProxyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">receiver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 等会谁来取值就做依赖收集</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reflect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, receiver);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">receiver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 等会赋值的时候可以重新触发effect执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reflect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, value, receiver);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createReactiveObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isReadonly</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> exisitingProxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reactiveMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果已经代理过则直接返回代理后的对象 </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (exisitingProxy) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exisitingProxy;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, mutableHandlers); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 对对象进行代理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reactiveMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target,proxy)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> proxy;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>从上面的代码可以看出，将代理的处理封装成了一个对象 <code>mutableHandlers</code>, 在触发get方法的时候进行依赖收集，在触发set方法的时候，进行依赖更新。</p><h3 id="关于reflect操作说明" tabindex="-1">关于Reflect操作说明 <a class="header-anchor" href="#关于reflect操作说明" aria-label="Permalink to &quot;关于Reflect操作说明&quot;">​</a></h3><p>我们看到上面代码的实现中，无论是get函数还是set函数，都没有直接返回<code>target[key]</code>,而是使用 <code>Reflect.get(target, key, receiver)</code> 和 <code>Reflect.set(target, key, value, receiver)</code></p><p>这么做的原因是保证this的指向</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> school </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;zf&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  get</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> num</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.name;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(school,{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">receiver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // return Reflect.get(target,key,receiver)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target[key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p.num</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>上面的代码，如果我们直接返回<code>target[key]</code>, this指向的是 school 而不是代理对象p,这点要格外注意，如果使用 <code>Reflect.get(target,key,receiver)</code> 就能解决这个问题。</p><h3 id="已经被代理过的对象不需要重复代理" tabindex="-1">已经被代理过的对象不需要重复代理 <a class="header-anchor" href="#已经被代理过的对象不需要重复代理" aria-label="Permalink to &quot;已经被代理过的对象不需要重复代理&quot;">​</a></h3><p>实际的业务场景中，我们代理一个对象让它成为响应式的，有一种场景是: <strong>一个对象被代理过了，我们不希望进行重复代理。</strong>，我们思考如何解决这个问题。其实思路非常巧妙，就是利用代理对象的特性，只要触发取值操作就能够被拦截，这个时候，我们就能发现它是一个代理对象，返回一个true就好了。</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactiveFlags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  IS_REACTIVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;__v_isReactive&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mutableHandlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProxyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">receiver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ReactiveFlags.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IS_REACTIVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在get中增加标识，当获取IS_REACTIVE时返回true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createReactiveObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isReadonly</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target[ReactiveFlags.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IS_REACTIVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]){ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在创建响应式对象时先进行取值，看是否已经是响应式对象</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>上面代码中，我们声明了一个枚举，普通对象第一次经过 <code>createReactiveObject</code> 函数的处理，取不到这个枚举的值，会走代理的逻辑，但是当代理的对象在此经过<code>createReactiveObject</code>这个函数的时候，就会触发get方法，判断是不是做了取值操作，如果是说明是已经代理过的对象，直接返回true就好。</p><h2 id="编写effect函数" tabindex="-1">编写effect函数 <a class="header-anchor" href="#编写effect函数" aria-label="Permalink to &quot;编写effect函数&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activeEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当前正在执行的effect</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  active</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  deps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 收集effect中使用到的属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  parent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.active) { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不是激活状态</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activeEffect; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当前的effect就是他的父亲</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      activeEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置成正在激活的是当前effect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      activeEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.parent; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 执行完毕后还原activeEffect</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fn); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建响应式effect</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  _effect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 让响应式effect默认执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>从上面的代码结构可以看出，我们使用的<code>effect</code>函数做了一层的封装，核心就是在内部通过<code>ReactiveEffect</code>这个class创建了一个实例对象,并将<strong>回调函数fn</strong>作为参数传递给它，这样的话，fn就会挂载到实例对象上。</p><p>调用的设计也比较巧妙，在<code>ReactiveEffect</code>内部有一个run方法，就是在run方法中执行了传递进来的回调函数。</p><p>我们知道，在触发get操作的时候，会进行依赖升级，那属性是如何记住，自己是被那个effect使用的呢？这里的设计也比较巧妙，在设计层面，创建了一个全局的变量 <code>activeEffect</code> 初始时候设置为undefined，在调用run方法的时候，将当前的实例对它进行赋值：</p><blockquote><p>run 方法中的this指向的是当前的实例<code>_effect</code></p></blockquote><p>接下来，当真实触发 <code>this.fn</code> 这个方法的时候，会走到代理对象的get方法，此时我们就能拿到访问属性是存在于哪个effect上面的。这样就可以做到一个关联。</p><p>我们有可能是执行多个effect，这个时候，为了保证不会被上一次的赋值影响，我们在 <code>finally</code> 中还原回原来的值。</p><p>上面说的是一种常规的场景，但是在真实的场景中，我们可能会存在嵌套的使用场景。对于嵌套的逻辑, 比如下面这种</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stage.age;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    app.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stage.name;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stage.address;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>本质上，我们想维护的关系是找到当前的属性和哪个effect关联，这里我们设置一个变量 parent，因为函数的执行就是不断地压栈，我们先记录下来自己的父亲，在函数执行完毕之后，将<code>activeEffect</code>这个变量重置为自己的父亲，这样控制权就交给了上一层。这样，嵌套的问题也解决了。</p><p>上面还有一个 deps 数组，是为了后续存放effect中用到的属性。</p><h2 id="依赖收集" tabindex="-1">依赖收集 <a class="header-anchor" href="#依赖收集" aria-label="Permalink to &quot;依赖收集&quot;">​</a></h2><p>在真实的使用场景中，一个effect可以包含多个属性，同样的，一个属性可以放在不同的effect中，这是一个典型的<strong>多对多</strong>的关系。我们需要做的就是让属性记住自己的effect，然后在属性变化的时候重新执行run方法达到更新的效果。</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, receiver) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ReactiveFlags.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IS_REACTIVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reflect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, receiver);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;get&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 依赖收集</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> targetMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WeakMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 记录依赖关系</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 只有当前 activeEffect 被激活的时候才需要依赖收集</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (activeEffect) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> depsMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// {对象：map}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">depsMap) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      targetMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, (depsMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dep </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> depsMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dep) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      depsMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, (dep </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// {对象：{ 属性 :[ dep, dep ]}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shouldTrack </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dep.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(activeEffect)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (shouldTrack) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dep.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(activeEffect);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      activeEffect.deps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dep); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 让effect记住dep，这样后续可以用于清理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>上面的代码中 <code>track</code> 是依赖收集的核心逻辑，我们最终需要的维护的一个数据结构大概是这样的：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} : {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Set:{effect,effect}} }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>最外层是一个weakMap,key就是target对象,value也是一个map,在内层的map中，key是对应的属性，value 是一个set，为什么要使用set，主要原因是为了去重处理，同一个effect中使用多个相同的属性，是不需要重复收集的。这样就实现了依赖收集的核心逻辑；</p><p>每个属性都拥有自己的一个dep，这个dep我们上面已经说过是个set集合，最终 <code>activeEffect</code> 中的 deps 数组中存放的就是所有的用到的属性的set集合。</p><h2 id="触发更新" tabindex="-1">触发更新 <a class="header-anchor" href="#触发更新" aria-label="Permalink to &quot;触发更新&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, value, receiver) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 等会赋值的时候可以重新触发effect执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oldValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target[key]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reflect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, value, receiver);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (oldValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;set&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key, value, oldValue)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">newValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">oldValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> depsMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取对应的映射表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">depsMap) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> effects</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> depsMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  effects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> effects.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (effect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activeEffect) effect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 防止死循环</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>上面代码描述了依赖更新的流程，核心逻辑就是找到具体属性收集的所有effect，然后进行遍历，这里面其实是一个个的实例，实例中有run方法，执行这个run方法，就达到了更新的目的。</p><h2 id="分支切换与cleanup" tabindex="-1">分支切换与cleanup <a class="header-anchor" href="#分支切换与cleanup" aria-label="Permalink to &quot;分支切换与cleanup&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ flag: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jw&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 副作用函数 (effect执行渲染了页面)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;render&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  document.body.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.flag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.age</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  state.flag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;修改name，原则上不更新&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;zf&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>上面的代码用例中，展示了一种切换的场景，也可以说是条件渲染的场景，理论上第一次flag为true的时候，在依赖收集的时候，会收集flag和name，在flag值更改之后，会收集flag和age。</p><p>在收集age的场景切换中，重新触发了name的修改，理论上不应该触发更新，可以在目前的代码逻辑中，还是会触发，这并不合理。</p><p>我们需要一种机制，去进行清理操作。</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cleanupEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">deps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> effect; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 清理effect</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deps.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    deps[i].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(effect);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  effect.deps.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  active</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  deps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 收集effect中使用到的属性</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  parent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activeEffect; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当前的effect就是他的父亲</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      activeEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置成正在激活的是当前effect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     cleanupEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 先清理在运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>从上面的清理操作可以看出，清理操作是在 <code>this.fn()</code> 这个函数执行之前进行的，回顾上面的场景我们可以知道，我们实际上做了双向的依赖收集，在effect上收集了很多的属性对应的set集合。我们要做的就是在下一次依赖收集之前，清理掉之前的依赖。这个就是 <code>cleanupEffect</code> 函数的作用。</p><blockquote><p>一边清理一边添加会造成逻辑上的死循环，所以，在源码实现阶段做了特殊的处理，这是比较细节的点。</p></blockquote><h2 id="停止effect" tabindex="-1">停止effect <a class="header-anchor" href="#停止effect" aria-label="Permalink to &quot;停止effect&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.active){ </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      cleanupEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fn); </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  _effect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> runner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _effect.run.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_effect);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  runner.effect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _effect;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回runner</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上述的实现中，数据变更会直接触发更新，这是响应式应该有的表现，但是在某些场景中，是需要有停止响应式的能力的，vue3的底层也提供了这种能力。</p><p>active 这个值默认为true，当用户手动调用 stop 方法的时候，这个值就变成了false，并且会把依赖收集清空，即使触发了数据改变，也不再会有更新。</p><p>当然我们在平时的开发过程中是不会直接调用这个方法的，但是源码中确实提供了这样的能力。</p><h2 id="调度执行" tabindex="-1">调度执行 <a class="header-anchor" href="#调度执行" aria-label="Permalink to &quot;调度执行&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fn,options.scheduler); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建响应式effect</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  _effect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 让响应式effect默认执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> runner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _effect.run.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_effect);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  runner.effect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _effect;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回runner</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">newValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">oldValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> depsMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">depsMap) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> effects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> depsMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (effects) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    effects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(effects);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> effects) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (effect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activeEffect) { </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(effect.scheduler){ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果有调度函数则执行调度函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          effect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scheduler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          effect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>在之前的分析中，effect 函数我们只传递了一个属性fn,也就是用户希望数据更新之后执行的函数，实际上，还可以传递另一个参数，这个参数是一个对象，对象中有一个属性 <code>scheduler</code></p><p>它也是一个函数，看到名字我们就能理解，这个调度函数如果传递的话，默认就会优先执行用户传递的这个函数，而不是之前的run函数，这个能力为后面的watch API的实现打下了基础。</p><h2 id="深度代理" tabindex="-1">深度代理 <a class="header-anchor" href="#深度代理" aria-label="Permalink to &quot;深度代理&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, receiver) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ReactiveFlags.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IS_REACTIVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 等会谁来取值就做依赖收集</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reflect.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, key, receiver);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;get&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res)){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上面的代码实现中，我们仅仅考虑了target是一层对象的情况，如果是一个嵌套对象，没有办法做到深层的代理，为了解决这个问题，我们可以在依赖收集的时候，做个额外的判断，当取值时返回的值是对象，则返回这个对象的代理对象，从而实现深度代理。</p><h2 id="关于数组元素的响应式处理" tabindex="-1">关于数组元素的响应式处理 <a class="header-anchor" href="#关于数组元素的响应式处理" aria-label="Permalink to &quot;关于数组元素的响应式处理&quot;">​</a></h2><p>Vue3 中对数组类型数据的响应式处理主要有以下几种方式:</p><ol><li><p><strong>使用 reactive 函数</strong>:</p><ul><li>可以使用 <code>reactive()</code> 函数将数组包装成一个响应式对象。这样数组的任何变化都会触发依赖于该数组的视图更新。</li><li>示例:<div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { reactive } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  myArray: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 修改数组会触发响应式更新</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state.myArray.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li><li><p><strong>使用 ref 函数</strong>:</p><ul><li>可以使用 <code>ref()</code> 函数将数组包装成一个响应式 ref 对象。</li><li>示例:<div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ref } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 修改数组会触发响应式更新</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myArray.value.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li><li><p><strong>使用变异方法</strong>:</p><ul><li>Vue.js 3 会自动劫持数组的变异方法,如 <code>push()</code>、<code>pop()</code>、<code>shift()</code>、<code>unshift()</code>、<code>splice()</code>、<code>sort()</code> 和 <code>reverse()</code>。</li><li>当使用这些方法修改数组时,Vue.js 会自动触发相应的响应式更新。</li><li>示例:<div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myArray.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 会触发响应式更新</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li><li><p><strong>使用 set 方法</strong>:</p><ul><li>如果需要动态设置数组中的某个索引项,可以使用 <code>Vue.set()</code> 或 <code>this.$set()</code> 方法。</li><li>示例:<div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Vue.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myArray, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">999</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 会触发响应式更新</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ol></div></div></main><footer class="VPDocFooter" data-v-0786f3f5 data-v-12c8f1cb><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-12c8f1cb><span class="visually-hidden" id="doc-footer-aria-label" data-v-12c8f1cb>Pager</span><div class="pager" data-v-12c8f1cb><a class="VPLink link pager-link prev" href="/vitepressBlog/vue/vue3/03.reactivity-1.html" data-v-12c8f1cb><!--[--><span class="desc" data-v-12c8f1cb>Previous page</span><span class="title" data-v-12c8f1cb>Vue3响应式</span><!--]--></a></div><div class="pager" data-v-12c8f1cb><a class="VPLink link pager-link next" href="/vitepressBlog/vue/vue3/05.reactivity-3.html" data-v-12c8f1cb><!--[--><span class="desc" data-v-12c8f1cb>Next page</span><span class="title" data-v-12c8f1cb>Computed & Watch</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ai_agent_01.agent的基本概念.md\":\"Ulne3hZC\",\"ai_agent_02.agent的核心组件.md\":\"B_hHmI6h\",\"ai_agent_agenttype.md\":\"JHLsDo-U\",\"ai_agent_claudeskills.md\":\"BTrptL2W\",\"ai_index.md\":\"C66IBHWQ\",\"algorithm_data-structure_index.md\":\"CopP5f3z\",\"algorithm_data-structure_数组.md\":\"mqDWxlG7\",\"algorithm_data-structure_栈.md\":\"DYrhVuvJ\",\"algorithm_data-structure_树.md\":\"IzfhzAps\",\"algorithm_data-structure_链表.md\":\"TR1OOQhC\",\"algorithm_data-structure_队列.md\":\"BEYvLnkO\",\"algorithm_index.md\":\"r5y69Zhy\",\"algorithm_leetcode_1.两数之和.md\":\"MeMAMZXc\",\"algorithm_leetcode_101.对称二叉树.md\":\"BIZ4TXiM\",\"algorithm_leetcode_102.二叉树的层序遍历.md\":\"DP0USBU5\",\"algorithm_leetcode_104.二叉树的最大深度.md\":\"19u_qJ4i\",\"algorithm_leetcode_11.盛水最多的容器.md\":\"CGemqrKZ\",\"algorithm_leetcode_121.买卖股票的最佳时机.md\":\"B_IIvZwe\",\"algorithm_leetcode_14.最长公共前缀.md\":\"Dpp4sBkX\",\"algorithm_leetcode_144.二叉树的前序遍历.md\":\"D9KtOjz_\",\"algorithm_leetcode_146.lru缓存.md\":\"C9dxZ2-k\",\"algorithm_leetcode_19.删除链表的倒数第n个节点.md\":\"DXlGlZXy\",\"algorithm_leetcode_199.二叉树的右视图.md\":\"94fqhoYI\",\"algorithm_leetcode_2.两数相加.md\":\"tzjq940-\",\"algorithm_leetcode_20.有效括号.md\":\"B8XuiPBq\",\"algorithm_leetcode_206.反转链表.md\":\"OBa7Lqy8\",\"algorithm_leetcode_21.合并两个有序链表.md\":\"4H34DBHh\",\"algorithm_leetcode_26.删除有序数组中的重复项.md\":\"IImsI06w\",\"algorithm_leetcode_3.无重复字符的最长子串.md\":\"DEd5lekN\",\"algorithm_leetcode_300.最长递增子序列.md\":\"Cu3XHC4C\",\"algorithm_leetcode_4.寻找两个正序数组的中位数.md\":\"zuGgAG1c\",\"algorithm_leetcode_46.全排列.md\":\"C_tLYV_o\",\"algorithm_leetcode_5.最长回文子串.md\":\"gksMyCVX\",\"algorithm_leetcode_53.最大子数组和.md\":\"DNU9UpNX\",\"algorithm_leetcode_54.螺旋矩阵.md\":\"8Ta7wT3n\",\"algorithm_leetcode_56.合并区间.md\":\"-_yn1Ou7\",\"algorithm_leetcode_674.最长连续递增序列.md\":\"C9qFxo1A\",\"algorithm_leetcode_7.整数反转.md\":\"v3DHGEX5\",\"algorithm_leetcode_70.爬楼梯.md\":\"CuM0F_wM\",\"algorithm_leetcode_88.merge sorted array.md\":\"C0e4cZev\",\"algorithm_leetcode_9.回文数.md\":\"tB4wfe_9\",\"algorithm_leetcode_index.md\":\"D06qAL0k\",\"algorithm_niuke_index.md\":\"r8GhCCzu\",\"algorithm_niuke_nc13.二叉树的最大深度.md\":\"hdQeNsFZ\",\"algorithm_niuke_nc140.排序.md\":\"Crf0qElD\",\"algorithm_niuke_nc141.判断是否为回文字符串.md\":\"DQuTzosE\",\"algorithm_niuke_nc15.求二叉树的层序遍历.md\":\"BZayA0Xd\",\"algorithm_niuke_nc163.最长上升子序列(一).md\":\"DJZ5YzcC\",\"algorithm_niuke_nc289.删除链表的节点.md\":\"AM9SrgFC\",\"algorithm_niuke_nc37.合并区间.md\":\"CCWCHJMk\",\"algorithm_niuke_nc4.判断链表中是否有环.md\":\"kSHXYhnD\",\"algorithm_niuke_nc41.最长无重复子数组.md\":\"BJklv6IQ\",\"algorithm_niuke_nc55.最长公共前缀.md\":\"BMmv_5Rk\",\"algorithm_niuke_nc57.反转数字.md\":\"BUoD1BLF\",\"algorithm_niuke_nc65.斐波那契数列.md\":\"BRKguWWi\",\"algorithm_niuke_nc91.最长上升子序列(三).md\":\"C4d_Tajd\",\"algorithm_offer_03.数组中重复的数字.md\":\"D9xuNvWN\",\"algorithm_offer_04.二维数组中的查找.md\":\"CU-RmMRY\",\"algorithm_offer_05.替换空格.md\":\"Dtck1zrP\",\"algorithm_offer_06.从尾到头打印链表.md\":\"BFXYqvX6\",\"algorithm_offer_09.用两个栈实现队列.md\":\"hd82eyR3\",\"algorithm_offer_11.旋转数组的最小数字.md\":\"CILu1Ue6\",\"algorithm_offer_18.删除链表的节点.md\":\"C_mcTv6A\",\"algorithm_offer_21.调整数组顺序使奇数位于偶数前面.md\":\"RPr_AW2W\",\"algorithm_offer_27.二叉树的镜像.md\":\"DJUzkXpC\",\"algorithm_offer_47.礼物的最大价值.md\":\"Xw8Zbof8\",\"algorithm_offer_55.二叉树的深度.md\":\"D3kA1yH0\",\"algorithm_offer_56.数组中只出现一次的两个数字.md\":\"BbKIgngP\",\"algorithm_offer_64.求1_2_3_..._n.md\":\"DBIk_Qez\",\"algorithm_offer_65.不用加减乘除做加法.md\":\"D0AtFLjm\",\"algorithm_offer_66.构建乘积数组.md\":\"BEYrhH9-\",\"algorithm_offer_69.跳台阶.md\":\"C0hdoryz\",\"algorithm_offer_71.跳台阶扩展问题.md\":\"B25aLCna\",\"algorithm_offer_81.调整数组顺序使奇数位于偶数前面(二).md\":\"evkA6Osd\",\"algorithm_offer_index.md\":\"CAMwLoXa\",\"back-end_database_index.md\":\"DM4NBkr6\",\"back-end_database_mongodb_index.md\":\"CM4nbN8C\",\"back-end_database_mysql_index.md\":\"Di3V_nQF\",\"back-end_database_redis_index.md\":\"Dn7c0XCI\",\"back-end_docker_docker-compose.md\":\"WE0fnW0F\",\"back-end_docker_dockerfile.md\":\"Cwe4Et9a\",\"back-end_docker_index.md\":\"Vc70jMF4\",\"back-end_index.md\":\"mwK5_5pT\",\"back-end_linux_index.md\":\"DSMF5Kqw\",\"back-end_rust_01-helloworld.md\":\"BCULdgE2\",\"back-end_rust_index.md\":\"Bzjf0kMU\",\"front-end-engineering_babel_01-into.md\":\"B-pXjHaW\",\"front-end-engineering_babel_index.md\":\"BVYdwKHp\",\"front-end-engineering_index.md\":\"GDqjzZmp\",\"front-end-engineering_micro-frontend_01.基础概念.md\":\"CHxGtPGB\",\"front-end-engineering_micro-frontend_02.原理实现.md\":\"7LIj_q9p\",\"front-end-engineering_webpack_webpack-config.md\":\"Xd4kABHC\",\"index.md\":\"BhFYxNGm\",\"js-base_index.md\":\"CEOHNeOg\",\"js-base_promise.all.md\":\"CkksWwsl\",\"js-base_promise.race.md\":\"BEercBrj\",\"js-base_高阶函数.md\":\"5H5i6s6Q\",\"node_index.md\":\"BktKrL0A\",\"node_node-base_buffer.md\":\"CF8nAjLq\",\"node_node-base_index.md\":\"CyWIcTDq\",\"react_index.md\":\"hACWHPZN\",\"react_react-advance_认识jsx.md\":\"DnhmvQe3\",\"react_react-hooks_react组件的通信强化方式.md\":\"C5QZ8Im_\",\"uniswap-v3-book_index.md\":\"BIqePOuw\",\"vue_index.md\":\"CQ32_ttE\",\"vue_vue2_01.source.md\":\"BJguELd2\",\"vue_vue2_02.渲染watcher.md\":\"CGWYH2Ce\",\"vue_vue2_index.md\":\"VB6GCA6Q\",\"vue_vue3_01.introduce.md\":\"DR-UlMHN\",\"vue_vue3_02.start.md\":\"PbieMxbq\",\"vue_vue3_03.reactivity-1.md\":\"BOdeAWsu\",\"vue_vue3_04.reactivity-2.md\":\"BAqMiYot\",\"vue_vue3_05.reactivity-3.md\":\"BwIqBdhn\",\"vue_vue3_06.ref.md\":\"BAHIo-1s\",\"vue_vue3_07.renderer.md\":\"ChA8HLeK\",\"vue_vue3_08.runtime-dom.md\":\"BSzAjWZT\",\"vue_vue3_09.runtime-core.md\":\"BYhlBWcV\",\"vue_vue3_10.diff.md\":\"Bg9Buyys\",\"vue_vue3_11.fragment.md\":\"71izqhMx\",\"vue_vue3_12.component.md\":\"DOsgueBW\",\"vue_vue3_13.compositionapi.md\":\"BubV5_2b\",\"vue_vue3_14.optimize.md\":\"CiXb-nXx\",\"vue_vue3_15.ast.md\":\"M8-e2Ck3\",\"vue_vue3_16.transform.md\":\"ra5Re_8p\",\"vue_vue3_17.codegen.md\":\"D8J3Qidq\",\"vue_vue3_index.md\":\"C4KW4wgp\",\"web3_blockchain-base-info_01-什么是区块链.md\":\"BechdgWU\",\"web3_index.md\":\"B44H_qHd\",\"web3_solidity-base_01-hellweb3.md\":\"BKYUWyRC\",\"web3_solidity-base_合约.md\":\"BX8tsQ3H\",\"web3_solidity-base_数学运算.md\":\"XA4lOlB-\",\"web3_solidity-base_状态变量和整数.md\":\"CTbCeUlz\",\"web3_solidity-base_课程概述.md\":\"DTv4TCzX\",\"web3_uniswapv4_01.基本介绍.md\":\"rvTeZTEt\",\"web3_uniswapv4_02.详解hooks机制.md\":\"BKuG-5hL\",\"writing_index.md\":\"BZeZeKH2\",\"writing_test.md\":\"DkP4fO3r\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"定投改变命运\",\"description\":\"用注意力填满 1000 小时就能练成任何你需要的技能……\",\"base\":\"/vitepressBlog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"AI\",\"link\":\"/ai/index\"},{\"text\":\"web3\",\"link\":\"/web3/index\"}],\"search\":{\"provider\":\"local\"},\"sidebar\":{\"/\":[{\"text\":\"数据结构\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"数组\",\"link\":\"/algorithm/data-structure/数组.md\"},{\"text\":\"栈\",\"link\":\"/algorithm/data-structure/栈.md\"},{\"text\":\"队列\",\"link\":\"/algorithm/data-structure/队列.md\"},{\"text\":\"链表\",\"link\":\"/algorithm/data-structure/链表.md\"}]},{\"text\":\"LeetCode算法题解\",\"link\":\"/algorithm/index#leetcode题解汇总\",\"collapsed\":false,\"items\":[{\"text\":\"1.两数之和\",\"link\":\"/algorithm/leetcode/1.两数之和.md\"},{\"text\":\"2.两数相加\",\"link\":\"/algorithm/leetcode/2.两数相加.md\"},{\"text\":\"3.无重复字符的最长子串\",\"link\":\"/algorithm/leetcode/3.无重复字符的最长子串.md\"},{\"text\":\"4.寻找两个正序数组的中位数\",\"link\":\"/algorithm/leetcode/4.寻找两个正序数组的中位数.md\"},{\"text\":\"5.最长回文子串\",\"link\":\"/algorithm/leetcode/5.最长回文子串.md\"},{\"text\":\"7.整数反转\",\"link\":\"/algorithm/leetcode/7.整数反转\"},{\"text\":\"11.盛水最多的容器\",\"link\":\"/algorithm/leetcode/11.盛水最多的容器\"},{\"text\":\"14.最长公共前缀\",\"link\":\"/algorithm/leetcode/14.最长公共前缀\"},{\"text\":\"19.删除链表的倒数第N个节点\",\"link\":\"/algorithm/leetcode/19.删除链表的倒数第N个节点\"},{\"text\":\"20.有效括号\",\"link\":\"/algorithm/leetcode/20.有效括号\"},{\"text\":\"21.合并两个有序链表\",\"link\":\"/algorithm/leetcode/21.合并两个有序链表\"},{\"text\":\"26.删除有序数组中的重复项\",\"link\":\"/algorithm/leetcode/26.删除有序数组中的重复项\"},{\"text\":\"46.全排列\",\"link\":\"/algorithm/leetcode/46.全排列\"},{\"text\":\"53.最大子数组和\",\"link\":\"/algorithm/leetcode/53.最大子数组和\"},{\"text\":\"54.螺旋矩阵\",\"link\":\"/algorithm/leetcode/54.螺旋矩阵\"},{\"text\":\"56.合并区间\",\"link\":\"/algorithm/leetcode/56.合并区间\"},{\"text\":\"70.爬楼梯\",\"link\":\"/algorithm/leetcode/70.爬楼梯\"},{\"text\":\"101.对称二叉树\",\"link\":\"/algorithm/leetcode/101.对称二叉树\"},{\"text\":\"102.二叉树的层序遍历\",\"link\":\"/algorithm/leetcode/102.二叉树的层序遍历\"},{\"text\":\"104.二叉树的最大深度\",\"link\":\"/algorithm/leetcode/104.二叉树的最大深度\"},{\"text\":\"144.二叉树的前序遍历\",\"link\":\"/algorithm/leetcode/144.二叉树的前序遍历\"},{\"text\":\"199.二叉树的右视图\",\"link\":\"/algorithm/leetcode/199.二叉树的右视图\"}]},{\"text\":\"牛客网算法题解\",\"link\":\"/algorithm/index#牛客网算法题解汇总\",\"collapsed\":false,\"items\":[{\"text\":\"NC4.判断链表中是否有环\",\"link\":\"/algorithm/niuke/NC4.判断链表中是否有环\"},{\"text\":\"NC13.二叉树的最大深度\",\"link\":\"/algorithm/niuke/NC13.二叉树的最大深度\"},{\"text\":\"NC37.合并区间\",\"link\":\"/algorithm/niuke/NC37.合并区间\"},{\"text\":\"NC41.最长无重复子数组\",\"link\":\"/algorithm/niuke/NC41.最长无重复子数组\"},{\"text\":\"NC57.反转数字\",\"link\":\"/algorithm/niuke/NC57.反转数字\"},{\"text\":\"NC65.斐波那契数列\",\"link\":\"/algorithm/niuke/NC65.斐波那契数列\"},{\"text\":\"NC140.排序\",\"link\":\"/algorithm/niuke/NC140.排序\"},{\"text\":\"NC141.判断是否为回文字符串\",\"link\":\"/algorithm/niuke/NC141.判断是否为回文字符串\"},{\"text\":\"NC289.删除链表的节点\",\"link\":\"/algorithm/niuke/NC289.删除链表的节点\"}]},{\"text\":\"剑指offer\",\"link\":\"/algorithm/index\",\"collapsed\":false,\"items\":[{\"text\":\"剑指Offer03.数组中重复的数字\",\"link\":\"/algorithm/offer/03.数组中重复的数字\"}]}],\"/uniswap-v3-book/\":[{\"text\":\"React进阶\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"认识jsx\",\"link\":\"/react/react-advance/认识jsx\"}]}],\"/react/\":[{\"text\":\"React进阶\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"认识jsx\",\"link\":\"/react/react-advance/认识jsx\"}]},{\"text\":\"React Hooks\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"React组件的通信强化方式\",\"link\":\"/react/react-hooks/React组件的通信强化方式.md\"}]}],\"/vue/\":[{\"text\":\"Vue3框架介绍\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Vue3整体架构\",\"link\":\"/vue/vue3/01.introduce\"},{\"text\":\"Vue3开发环境搭建\",\"link\":\"/vue/vue3/02.start\"}]},{\"text\":\"Vue3响应式原理\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Vue3响应式\",\"link\":\"/vue/vue3/03.reactivity-1\"},{\"text\":\"Reactive & Effect\",\"link\":\"/vue/vue3/04.reactivity-2\"},{\"text\":\"Computed & Watch\",\"link\":\"/vue/vue3/05.reactivity-3\"},{\"text\":\"Ref实现原理\",\"link\":\"/vue/vue3/06.ref\"}]},{\"text\":\"Vue3渲染原理\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Vue3自定义渲染器\",\"link\":\"/vue/vue3/07.renderer\"},{\"text\":\"Runtime DOM\",\"link\":\"/vue/vue3/08.runtime-dom\"},{\"text\":\"Runtime Core\",\"link\":\"/vue/vue3/09.runtime-core\"}]},{\"text\":\"Vue3 Diff 算法\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Diff流程\",\"link\":\"/vue/vue3/10.diff\"}]},{\"text\":\"组件渲染原理\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"text、Fragment\",\"link\":\"/vue/vue3/11.fragment\"},{\"text\":\"组件渲染\",\"link\":\"/vue/vue3/12.component\"},{\"text\":\"setup函数\",\"link\":\"/vue/vue3/13.compositionApi\"}]},{\"text\":\"模板编译原理\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"编译优化\",\"link\":\"/vue/vue3/14.optimize\"},{\"text\":\"模板转化为AST\",\"link\":\"/vue/vue3/15.ast\"},{\"text\":\"代码转化\",\"link\":\"/vue/vue3/16.transform\"},{\"text\":\"代码生成\",\"link\":\"/vue/vue3/17.codegen\"}]},{\"text\":\"Vue2核心原理\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Vue2初渲染原理\",\"link\":\"/vue/vue2/01.source\"},{\"text\":\"创建渲染Watcher\",\"link\":\"/vue/vue2/02.渲染watcher\"}]}],\"/node/\":[{\"text\":\"Node.js\",\"collapsed\":false,\"link\":\"\",\"items\":[{\"text\":\"Node基础\",\"link\":\"/node/node-base/index\"},{\"text\":\"Buffer\",\"link\":\"/node/node-base/buffer\"}]}],\"/front-end-engineering/\":[{\"text\":\"Babel\",\"link\":\"/front-end-engineering/babel/index\",\"collapsed\":false,\"items\":[{\"text\":\"Babel简介\",\"link\":\"/front-end-engineering/babel/01-into\"}]},{\"text\":\"Webpack\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"webpack配置的底层逻辑\",\"link\":\"/front-end-engineering/webpack/webpack-config\"}]},{\"text\":\"微前端\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"微前端基本概念\",\"link\":\"/front-end-engineering/micro-frontend/01.基础概念\"},{\"text\":\"原理实现\",\"link\":\"/front-end-engineering/micro-frontend/02.原理实现\"}]}],\"/ai/\":[{\"text\":\"AI\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"agent基本概念\",\"link\":\"/ai/agent/01.agent的基本概念\"},{\"text\":\"agent核心组件\",\"link\":\"/ai/agent/02.agent的核心组件\"}]}],\"/back-end/\":[{\"text\":\"容器化\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Docker\",\"link\":\"/back-end/docker/index\"},{\"text\":\"Dockerfile\",\"link\":\"/back-end/docker/dockerfile\"},{\"text\":\"Docker Compose\",\"link\":\"/back-end/docker/docker-compose\"}]},{\"text\":\"Linux\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"linux\",\"link\":\"/back-end/linux/index\"}]},{\"text\":\"数据库\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Redis\",\"link\":\"/back-end/database/redis/index\"},{\"text\":\"MySQL\",\"link\":\"/back-end/database/mysql/index\"},{\"text\":\"MongoDB\",\"link\":\"/back-end/database/mongodb/index\"}]},{\"text\":\"Rust\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"第1节：hellowrold\",\"link\":\"/back-end/rust/01-helloworld\"}]}],\"/web3/\":[{\"text\":\"blockchain基础知识\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"第1节：什么是区块链\",\"link\":\"/web3/blockchain-base-info/01-什么是区块链.md\",\"collapsed\":false}]},{\"text\":\"Solidity基础\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"第1节：Hello Web3\",\"link\":\"/web3/solidity-base/01-hellweb3.md\",\"collapsed\":false}]},{\"text\":\"Solidity进阶\",\"link\":\"\",\"collapsed\":false,\"items\":[]},{\"text\":\"Uniswapv4\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"第1节：Hello Uniswapv4\",\"link\":\"/web3/uniswapv4/01.基本介绍.md\",\"collapsed\":false}]}],\"/low-code/\":[{\"text\":\"从0打造通用型低代码产品\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"序章：前端的价值\",\"link\":\"/low-code/01-前端的价值\",\"collapsed\":false},{\"text\":\"前言：什么是低代码\",\"link\":\"/low-code/02-什么是低代码\",\"collapsed\":false},{\"text\":\"MRD：产品目标与设计\",\"link\":\"/low-code/03-产品的目标与设计\",\"collapsed\":false},{\"text\":\"第四章：数学运算\",\"link\":\"/web3/solidity/数学运算.md\",\"collapsed\":false}]}],\"/js-base/\":[{\"text\":\"JavaScript基础\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"高阶函数\",\"link\":\"/js-base/高阶函数\"}]},{\"text\":\"JavaScript异步\",\"link\":\"\",\"collapsed\":false,\"items\":[{\"text\":\"Promise.all\",\"link\":\"/js-base/promise.all\"},{\"text\":\"Promise.race\",\"link\":\"/js-base/promise.race\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/MagicalBridge\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>