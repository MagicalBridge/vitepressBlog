import{_ as a,c as t,o as i,aj as e}from"./chunks/framework.K2WCgrB4.js";const q=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"web3/uniswapv4/01.基本介绍.md","filePath":"web3/uniswapv4/01.基本介绍.md"}'),l={name:"web3/uniswapv4/01.基本介绍.md"},o=e('<h2 id="一、uniswap-v4-是什么-背景" tabindex="-1">一、Uniswap v4 是什么？（背景） <a class="header-anchor" href="#一、uniswap-v4-是什么-背景" aria-label="Permalink to &quot;一、Uniswap v4 是什么？（背景）&quot;">​</a></h2><p><strong>Uniswap v4 并不是简单的 v3 升级版</strong>，而是一次<strong>架构级重构</strong>：</p><ul><li>v2：恒定乘积 AMM（简单、通用）</li><li>v3：集中流动性（效率极高，但复杂度暴增）</li><li><strong>v4：AMM 框架化（Protocol → Platform）</strong></li></ul><p>👉 核心思想是：</p><p><strong>Uniswap 不再内置所有功能，而是提供一个高性能、可扩展的 AMM 内核，让开发者“插插件（Hooks）”来自定义行为。</strong></p><hr><h2 id="二、uniswap-v4-的核心特性" tabindex="-1">二、Uniswap v4 的核心特性 <a class="header-anchor" href="#二、uniswap-v4-的核心特性" aria-label="Permalink to &quot;二、Uniswap v4 的核心特性&quot;">​</a></h2><h3 id="_1️⃣-hooks-最核心的创新" tabindex="-1">1️⃣ Hooks（最核心的创新） <a class="header-anchor" href="#_1️⃣-hooks-最核心的创新" aria-label="Permalink to &quot;1️⃣ Hooks（最核心的创新）&quot;">​</a></h3><h4 id="是什么" tabindex="-1">是什么？ <a class="header-anchor" href="#是什么" aria-label="Permalink to &quot;是什么？&quot;">​</a></h4><p>Hooks 是<strong>可插入到池生命周期中的外部合约逻辑</strong>，可在以下关键节点执行自定义代码：</p><ul><li><code>beforeSwap / afterSwap</code></li><li><code>beforeAddLiquidity / afterAddLiquidity</code></li><li><code>beforeRemoveLiquidity / afterRemoveLiquidity</code></li><li><code>beforeInitialize</code></li></ul><p>你可以把它理解为：</p><p><strong>AMM 的“中间件 / 插件系统”</strong></p><h4 id="能做什么" tabindex="-1">能做什么？ <a class="header-anchor" href="#能做什么" aria-label="Permalink to &quot;能做什么？&quot;">​</a></h4><p>通过 Hooks，你可以实现：</p><ul><li>动态手续费（根据波动率、交易方向）</li><li>限价单 / TWAMM（时间加权订单）</li><li>链上做市策略</li><li>LP 激励 / 手续费分成</li><li>MEV 防护逻辑</li><li>与外部协议联动（借贷、期权、收益聚合）</li></ul><h4 id="解决了什么问题" tabindex="-1">解决了什么问题？ <a class="header-anchor" href="#解决了什么问题" aria-label="Permalink to &quot;解决了什么问题？&quot;">​</a></h4><table tabindex="0"><thead><tr><th>旧版本问题</th><th>Hooks 的解决方式</th></tr></thead><tbody><tr><td>v3 功能写死在协议里</td><td>功能外包给 Hook 合约</td></tr><tr><td>新功能必须升级协议</td><td>无需改核心代码</td></tr><tr><td>DeFi 创新碎片化</td><td>统一在 AMM 层完成</td></tr></tbody></table><p>👉 <strong>Uniswap v4 从“产品”变成“DeFi 基础设施平台”</strong></p><hr><h3 id="_2️⃣-singleton-合约-单合约架构" tabindex="-1">2️⃣ Singleton 合约（单合约架构） <a class="header-anchor" href="#_2️⃣-singleton-合约-单合约架构" aria-label="Permalink to &quot;2️⃣ Singleton 合约（单合约架构）&quot;">​</a></h3><h4 id="是什么-1" tabindex="-1">是什么？ <a class="header-anchor" href="#是什么-1" aria-label="Permalink to &quot;是什么？&quot;">​</a></h4><p>v2 / v3：</p><ul><li>每个 Pool = 一个独立合约</li></ul><p>v4：</p><ul><li><strong>所有 Pool 共用一个 Singleton 合约</strong></li><li>Pool 状态通过 <code>poolId</code> 映射存储</li></ul><h4 id="解决了什么问题-1" tabindex="-1">解决了什么问题？ <a class="header-anchor" href="#解决了什么问题-1" aria-label="Permalink to &quot;解决了什么问题？&quot;">​</a></h4><table tabindex="0"><thead><tr><th>问题</th><th>v4 改进</th></tr></thead><tbody><tr><td>Pool 部署成本高</td><td>不再部署新合约</td></tr><tr><td>跨池交互昂贵</td><td>同一合约内操作</td></tr><tr><td>Gas 利用率低</td><td>状态集中、复用</td></tr></tbody></table><p>👉 <strong>Gas 成本显著下降（尤其多跳 Swap、复杂策略）</strong></p><hr><h3 id="_3️⃣-flash-accounting-闪电记账" tabindex="-1">3️⃣ Flash Accounting（闪电记账） <a class="header-anchor" href="#_3️⃣-flash-accounting-闪电记账" aria-label="Permalink to &quot;3️⃣ Flash Accounting（闪电记账）&quot;">​</a></h3><h4 id="是什么-2" tabindex="-1">是什么？ <a class="header-anchor" href="#是什么-2" aria-label="Permalink to &quot;是什么？&quot;">​</a></h4><p>v4 在一次交易（Transaction）中：</p><ul><li>不立即做 Token 转账</li><li>只在内存中做<strong>净额记账</strong></li><li>在交易结束时一次性结算</li></ul><h4 id="类比理解" tabindex="-1">类比理解： <a class="header-anchor" href="#类比理解" aria-label="Permalink to &quot;类比理解：&quot;">​</a></h4><p>像是「公司月末统一结算，而不是每笔都银行转账」</p><h4 id="解决了什么问题-2" tabindex="-1">解决了什么问题？ <a class="header-anchor" href="#解决了什么问题-2" aria-label="Permalink to &quot;解决了什么问题？&quot;">​</a></h4><table tabindex="0"><thead><tr><th>旧问题</th><th>新方案</th></tr></thead><tbody><tr><td>每一步都 ERC20 transfer</td><td>最后统一结算</td></tr><tr><td>transfer 极其耗 Gas</td><td>内存账本</td></tr><tr><td>多 Hook / 多池交互成本高</td><td>聚合成本</td></tr></tbody></table><p>👉 <strong>这是 v4 能承载复杂 Hooks 的底层基础</strong></p><hr><h3 id="_4️⃣-原生支持-eth-无需-weth" tabindex="-1">4️⃣ 原生支持 ETH（无需 WETH） <a class="header-anchor" href="#_4️⃣-原生支持-eth-无需-weth" aria-label="Permalink to &quot;4️⃣ 原生支持 ETH（无需 WETH）&quot;">​</a></h3><h4 id="是什么-3" tabindex="-1">是什么？ <a class="header-anchor" href="#是什么-3" aria-label="Permalink to &quot;是什么？&quot;">​</a></h4><p>v4 <strong>直接支持原生 ETH</strong>，不需要 WETH 包装。</p><h4 id="解决了什么问题-3" tabindex="-1">解决了什么问题？ <a class="header-anchor" href="#解决了什么问题-3" aria-label="Permalink to &quot;解决了什么问题？&quot;">​</a></h4><ul><li>减少一次 <code>wrap / unwrap</code></li><li>降低 Gas</li><li>降低用户理解成本</li><li>Hook 可直接处理 ETH（如手续费燃烧）</li></ul><hr><h3 id="_5️⃣-自定义手续费-手续费逻辑外包" tabindex="-1">5️⃣ 自定义手续费 &amp; 手续费逻辑外包 <a class="header-anchor" href="#_5️⃣-自定义手续费-手续费逻辑外包" aria-label="Permalink to &quot;5️⃣ 自定义手续费 &amp; 手续费逻辑外包&quot;">​</a></h3><h4 id="v3-的限制" tabindex="-1">v3 的限制 <a class="header-anchor" href="#v3-的限制" aria-label="Permalink to &quot;v3 的限制&quot;">​</a></h4><ul><li>手续费是固定档位（0.05%、0.3%、1%）</li><li>只能在池初始化时选择</li></ul><h4 id="v4-的改变" tabindex="-1">v4 的改变 <a class="header-anchor" href="#v4-的改变" aria-label="Permalink to &quot;v4 的改变&quot;">​</a></h4><ul><li>手续费可以：</li></ul><ul><li><ul><li>动态计算</li><li>按用户、方向、时间变化</li><li>完全由 Hook 控制</li></ul></li></ul><h4 id="解决了什么问题-4" tabindex="-1">解决了什么问题？ <a class="header-anchor" href="#解决了什么问题-4" aria-label="Permalink to &quot;解决了什么问题？&quot;">​</a></h4><ul><li>高波动 ≠ 低波动资产，却用同一费率</li><li>LP 收益无法适配市场状态</li><li>做市策略无法链上表达</li></ul><hr><h3 id="_6️⃣-更强的可组合性-defi-原语升级" tabindex="-1">6️⃣ 更强的可组合性（DeFi 原语升级） <a class="header-anchor" href="#_6️⃣-更强的可组合性-defi-原语升级" aria-label="Permalink to &quot;6️⃣ 更强的可组合性（DeFi 原语升级）&quot;">​</a></h3><p>Hooks + Singleton + Flash Accounting 让：</p><ul><li>Swap = 可编程行为</li><li>LP = 可定制金融产品</li><li>Pool = 策略容器</li></ul><p>你甚至可以构建： `</p><ul><li>AMM + 借贷联动池</li><li>自动对冲池</li><li>LST / LSD 专用池</li><li>期权 / 永续模拟池</li></ul><hr><h2 id="三、uniswap-v4-解决的-本质问题" tabindex="-1">三、Uniswap v4 解决的“本质问题” <a class="header-anchor" href="#三、uniswap-v4-解决的-本质问题" aria-label="Permalink to &quot;三、Uniswap v4 解决的“本质问题”&quot;">​</a></h2><h3 id="问题-1-amm-功能创新太慢" tabindex="-1">问题 1：AMM 功能创新太慢 <a class="header-anchor" href="#问题-1-amm-功能创新太慢" aria-label="Permalink to &quot;问题 1：AMM 功能创新太慢&quot;">​</a></h3><p>v4：<strong>协议稳定，功能外包</strong></p><hr><h3 id="问题-2-gas-成本制约复杂策略" tabindex="-1">问题 2：Gas 成本制约复杂策略 <a class="header-anchor" href="#问题-2-gas-成本制约复杂策略" aria-label="Permalink to &quot;问题 2：Gas 成本制约复杂策略&quot;">​</a></h3><p>v4：<strong>Singleton + Flash Accounting</strong></p><hr><h3 id="问题-3-lp-策略无法链上表达" tabindex="-1">问题 3：LP 策略无法链上表达 <a class="header-anchor" href="#问题-3-lp-策略无法链上表达" aria-label="Permalink to &quot;问题 3：LP 策略无法链上表达&quot;">​</a></h3><p>v4：<strong>Hooks = 策略执行器</strong></p><hr><h3 id="问题-4-defi-组合复杂、碎片化" tabindex="-1">问题 4：DeFi 组合复杂、碎片化 <a class="header-anchor" href="#问题-4-defi-组合复杂、碎片化" aria-label="Permalink to &quot;问题 4：DeFi 组合复杂、碎片化&quot;">​</a></h3><p>v4：<strong>统一在 AMM 层完成组合</strong></p><hr><h2 id="四、一句话总结" tabindex="-1">四、一句话总结 <a class="header-anchor" href="#四、一句话总结" aria-label="Permalink to &quot;四、一句话总结&quot;">​</a></h2><p><strong>Uniswap v4 不再是一个“交易所协议”，而是一个“可编程流动性操作系统”。</strong></p><p>如果你愿意，下一步我可以帮你：</p><ul><li>用 <strong>v3 vs v4 对比表</strong>再深入一层</li><li>讲 <strong>Hooks 的安全模型 &amp; 风险点</strong></li><li>从 <strong>开发者视角写一个 Hook 示例（伪代码）</strong></li></ul>',78),r=[o];function n(h,d,s,u,c,p){return i(),t("div",null,r)}const g=a(l,[["render",n]]);export{q as __pageData,g as default};
