---
sidebar: auto
---

# 模板转化AST语法树

我们写的模板浏览器是不识别的，需要借助vue内置的编译工具，将其生成函数，才能真正的渲染执行。模板编译会将Vue中对template属性会编译成render方法。

增添新的包compiler-core/package.json:

```json
{
  "name": "@vue/compiler-core",
  "version": "1.0.0",
  "description": "@vue/compiler-core",
  "main": "index.js",
  "module": "dist/compiler-core.esm-bundler.js",
  "buildOptions": {
    "name": "VueCompilerCore",
    "compat": true,
    "formats": [
      "esm-bundler",
      "cjs"
    ]
  }
}
```

> 我们将开发环境下的打包入口改为 compile-core，这里我们先提供所需要ast的节点类型：

## 核心方法：compile

```js
export function compile(template){
  // 1.将模板转化成ast语法树
  const ast = baseParse(template);
  // 2.对ast语法树进行转化
  transform(ast);
  // 3.生成代码
  return generate(ast)
}
```

从上面的实现可以看出，整个代码实现可以分为三个步骤：
- 1、将我们写的模板解析成ast语法树
- 2、对ast语法树进行遍历转化，添加一些辅助函数。
- 3、代码生成，本质上就是生成字符串

## 生成 AST 语法树

准备语法树相关type：

```js
export const enum NodeTypes {
  ROOT, // 根节点
  ELEMENT, // 元素
  TEXT, // 文本
  COMMENT, // 注释
  SIMPLE_EXPRESSION, // 简单表达式
  INTERPOLATION, // 模板表达式
  ATTRIBUTE,
  DIRECTIVE,
  // containers
  COMPOUND_EXPRESSION, // 复合表达式
  IF,
  IF_BRANCH,
  FOR,
  TEXT_CALL, // 文本调用
  // codegen
  VNODE_CALL, // 元素调用
  JS_CALL_EXPRESSION, // js调用表达式
}
```
